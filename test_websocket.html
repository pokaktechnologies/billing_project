<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Chat Test</title>
</head>
<body>
    <h2>Chat Test</h2>
    <div id="chat-messages" style="border: 1px solid #ccc; height: 200px; overflow-y: auto; padding: 10px;"></div>
    <input type="text" id="message-input" placeholder="Type a message...">
    <button id="send-button">Send</button>
    <script>
        // Configuration
        const roomId = 2; // Replace with a valid ChatRoom ID from your database
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzYzOTU5OTIxLCJpYXQiOjE3NjE2MjcxMjEsImp0aSI6IjkxZjkzYjNlNThhYTQxNjZiODFmY2Y0NzIxMDFkZTIwIiwidXNlcl9pZCI6NX0.FwQT0lzaEMRufAOM76756K_scOWJSugfIeS6sWrQSg0'; // Replace with a valid JWT token from your authentication
        const chatSocket = new WebSocket(`ws://127.0.0.1:9000/ws/chat/2/?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzYzOTU5OTIxLCJpYXQiOjE3NjE2MjcxMjEsImp0aSI6IjkxZjkzYjNlNThhYTQxNjZiODFmY2Y0NzIxMDFkZTIwIiwidXNlcl9pZCI6NX0.FwQT0lzaEMRufAOM76756K_scOWJSugfIeS6sWrQSg0`);

        // Event Handlers
        chatSocket.onopen = function(e) {
            console.log('WebSocket connected successfully');
            document.getElementById('chat-messages').innerHTML += '<p style="color: green;">Connected to room ' + roomId + '</p>';
        };

        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            console.log('Received message:', data);
            const messagesDiv = document.getElementById('chat-messages');
            messagesDiv.innerHTML += `<p><strong>${data.sender_name}</strong>: ${data.content} (${data.timestamp})</p>`;
        };

        chatSocket.onclose = function(e) {
            console.error('WebSocket closed unexpectedly:', e);
            document.getElementById('chat-messages').innerHTML += '<p style="color: red;">Disconnected</p>';
        };

        chatSocket.onerror = function(e) {
            console.error('WebSocket error:', e);
            document.getElementById('chat-messages').innerHTML += '<p style="color: red;">Error occurred</p>';
        };

        // Send Message
        document.getElementById('send-button').onclick = function() {
            const content = document.getElementById('message-input').value.trim();
            if (content) {
                chatSocket.send(JSON.stringify({ content: content }));
                document.getElementById('message-input').value = '';
            } else {
                alert('Please enter a message');
            }
        };
    </script>
</body>
</html>